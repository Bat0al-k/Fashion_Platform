import{e as y,m as P}from"./chunk-DR4VOI5K.js";import{b as D,c as h,d as q,e as L,g as V,h as G,i as $,m as M,o as E}from"./chunk-O6KHI3MG.js";import{a as N}from"./chunk-AZEPATSB.js";import"./chunk-5IWPKPXY.js";import{$a as w,B as s,Ba as S,E as b,F as C,Va as R,W as m,da as c,fa as d,ja as n,ka as i,la as u,nb as A,qa as _,ra as x,rb as v,ua as l,x as k,y as F}from"./chunk-CONT6OMZ.js";var z=(()=>{class e{constructor(){this.authService=s(y),this.toastr=s(P),this.alert=s(N)}loadProfileData(o){this.authService.getProfile().subscribe({next:t=>{console.log("\u2705 Profile response:",t);let r=t.name?.split(" ")||[],a=r[0]||"",f=r.slice(1).join(" ")||"";o.patchValue({firstName:a,lastName:f,email:t.email,address:t.address||"",currentPassword:"",newPassword:"",confirmNewPassword:""})},error:()=>this.alert.show("Failed to load profile")})}updateProfile(o){let{firstName:t,lastName:r,currentPassword:a,newPassword:f,confirmNewPassword:g}=o.getRawValue();if(f&&f!==g){this.toastr.error("Passwords don't match");return}let j={name:`${t} ${r}`};a&&f&&(j.currentPassword=a,j.newPassword=f),this.authService.updateProfile(j).subscribe({next:()=>{this.alert.show("Profile updated successfully"),o.reset()},error:()=>this.alert.show("Failed to update profile")})}static{this.\u0275fac=function(t){return new(t||e)}}static{this.\u0275prov=k({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();function Y(e,p){e&1&&(n(0,"div"),l(1,"First name is required."),i())}function H(e,p){e&1&&(n(0,"div"),l(1,"At least 2 characters required."),i())}function J(e,p){e&1&&(n(0,"div"),l(1,"Only letters are allowed."),i())}function K(e,p){if(e&1&&(n(0,"div",18),c(1,Y,2,0,"div",19)(2,H,2,0,"div",19)(3,J,2,0,"div",19),i()),e&2){let o,t,r,a=x();m(),d("ngIf",(o=a.profileForm.get("firstName"))==null||o.errors==null?null:o.errors.required),m(),d("ngIf",(t=a.profileForm.get("firstName"))==null||t.errors==null?null:t.errors.minlength),m(),d("ngIf",(r=a.profileForm.get("firstName"))==null||r.errors==null?null:r.errors.pattern)}}function Q(e,p){e&1&&(n(0,"div"),l(1,"Last name is required."),i())}function U(e,p){e&1&&(n(0,"div"),l(1,"At least 2 characters required."),i())}function W(e,p){e&1&&(n(0,"div"),l(1,"Only letters are allowed."),i())}function X(e,p){if(e&1&&(n(0,"div",18),c(1,Q,2,0,"div",19)(2,U,2,0,"div",19)(3,W,2,0,"div",19),i()),e&2){let o,t,r,a=x();m(),d("ngIf",(o=a.profileForm.get("lastName"))==null||o.errors==null?null:o.errors.required),m(),d("ngIf",(t=a.profileForm.get("lastName"))==null||t.errors==null?null:t.errors.minlength),m(),d("ngIf",(r=a.profileForm.get("lastName"))==null||r.errors==null?null:r.errors.pattern)}}function ee(e,p){e&1&&(n(0,"div"),l(1,"Password must be at least 6 characters."),i())}function te(e,p){if(e&1&&(n(0,"div",20),c(1,ee,2,0,"div",19),i()),e&2){let o,t=x();m(),d("ngIf",(o=t.profileForm.get("newPassword"))==null||o.errors==null?null:o.errors.minlength)}}function re(e,p){e&1&&(n(0,"div",21),l(1," Passwords do not match. "),i())}var B=(()=>{class e{constructor(){this.toastr=s(P),this.fb=s(M),this.profileFormService=s(z)}ngOnInit(){this.profileForm=this.fb.group({firstName:["",[h.required,h.minLength(2),h.pattern(/^[A-Za-z\u0600-\u06FF ]+$/)]],lastName:["",[h.required,h.minLength(2),h.pattern(/^[A-Za-z\u0600-\u06FF ]+$/)]],email:[{value:"",disabled:!0}],address:[{value:"",disabled:!0}],dateOfBirth:[{value:"",disabled:!0}],currentPassword:[""],newPassword:["",[h.minLength(6)]],confirmNewPassword:[""]},{validators:[this.matchPasswords]}),this.profileFormService.loadProfileData(this.profileForm)}matchPasswords(o){let t=o.get("newPassword")?.value,r=o.get("confirmNewPassword")?.value;return t===r?null:{passwordsMismatch:!0}}saveChanges(){if(this.profileForm.invalid){this.toastr.error("Please fix the errors in the form.");return}this.profileFormService.updateProfile(this.profileForm)}resetForm(){this.profileFormService.loadProfileData(this.profileForm),this.toastr.info("Changes have been discarded.")}static{this.\u0275fac=function(t){return new(t||e)}}static{this.\u0275cmp=b({type:e,selectors:[["app-profile-form"]],standalone:!0,features:[S],decls:33,vars:6,consts:[[1,"card","p-4","shadow-sm"],[1,"fw-bold","mb-4","text-danger"],[3,"ngSubmit","formGroup"],[1,"row","mb-3"],[1,"col"],["formControlName","firstName","placeholder","New first name",1,"form-control"],["class","text-danger mt-1 small",4,"ngIf"],["formControlName","lastName","placeholder","New last name",1,"form-control"],["formControlName","email",1,"form-control",3,"disabled"],[1,"mb-3"],["formControlName","currentPassword","placeholder","Current Password","type","password",1,"form-control","mb-2"],["formControlName","newPassword","placeholder","New Password","type","password",1,"form-control","mb-2"],["class","text-danger small mb-2",4,"ngIf"],["formControlName","confirmNewPassword","placeholder","Confirm New Password","type","password",1,"form-control"],["class","text-danger small mt-1",4,"ngIf"],[1,"d-flex","justify-content-end","gap-2"],["type","button",1,"btn","btn-outline-secondary",3,"click"],["type","submit",1,"btn","btn-danger"],[1,"text-danger","mt-1","small"],[4,"ngIf"],[1,"text-danger","small","mb-2"],[1,"text-danger","small","mt-1"]],template:function(t,r){if(t&1&&(n(0,"div",0)(1,"h5",1),l(2,"Edit Your Profile"),i(),n(3,"form",2),_("ngSubmit",function(){return r.saveChanges()}),n(4,"div",3)(5,"div",4)(6,"label"),l(7,"First Name"),i(),u(8,"input",5),c(9,K,4,3,"div",6),i(),n(10,"div",4)(11,"label"),l(12,"Last Name"),i(),u(13,"input",7),c(14,X,4,3,"div",6),i()(),n(15,"div",3)(16,"div",4)(17,"label"),l(18,"Email"),i(),u(19,"input",8),i()(),n(20,"div",9)(21,"label"),l(22,"Password Changes"),i(),u(23,"input",10)(24,"input",11),c(25,te,2,1,"div",12),u(26,"input",13),c(27,re,2,0,"div",14),i(),n(28,"div",15)(29,"button",16),_("click",function(){return r.resetForm()}),l(30,"Cancel"),i(),n(31,"button",17),l(32,"Save Changes"),i()()()()),t&2){let a,f,g,O;m(3),d("formGroup",r.profileForm),m(6),d("ngIf",((a=r.profileForm.get("firstName"))==null?null:a.touched)&&((a=r.profileForm.get("firstName"))==null?null:a.invalid)),m(5),d("ngIf",((f=r.profileForm.get("lastName"))==null?null:f.touched)&&((f=r.profileForm.get("lastName"))==null?null:f.invalid)),m(5),d("disabled",!0),m(6),d("ngIf",((g=r.profileForm.get("newPassword"))==null?null:g.touched)&&((g=r.profileForm.get("newPassword"))==null?null:g.invalid)),m(2),d("ngIf",r.profileForm.hasError("passwordsMismatch")&&((O=r.profileForm.get("confirmNewPassword"))==null?null:O.touched))}},dependencies:[w,R,E,V,D,q,L,G,$,v],styles:["input[disabled][_ngcontent-%COMP%]{cursor:not-allowed;background-color:#8e8f8f9f}"]})}}return e})();var T=(()=>{class e{constructor(){this.fb=s(M),this.router=s(A),this.alert=s(N),this.authService=s(y),this.toastr=s(P)}ngOnInit(){this.profileForm=this.fb.group({name:[""],email:[{value:"",disabled:!0}],currentPassword:[""],newPassword:[""],confirmNewPassword:[""]}),this.loadProfile()}loadProfile(){this.authService.getProfile().subscribe({next:o=>{this.profileForm.patchValue({name:o.name,email:o.email})},error:()=>{this.toastr.error("Failed to load profile")}})}saveChanges(){let{name:o,currentPassword:t,newPassword:r,confirmNewPassword:a}=this.profileForm.getRawValue();if(r&&r!==a){this.toastr.error("Passwords don't match");return}this.authService.updateProfile({name:o,currentPassword:t,newPassword:r}).subscribe({next:()=>this.toastr.success("Profile updated successfully"),error:()=>this.toastr.error("Failed to update profile")})}goToOrders(){this.router.navigate(["/orders"])}logout(){try{this.authService.logout(),this.alert.show("Logged out successfully","success"),this.router.navigate(["/auth/login"])}catch{this.alert.show("Failed to log out","error")}}static{this.\u0275fac=function(t){return new(t||e)}}static{this.\u0275cmp=b({type:e,selectors:[["app-profile"]],standalone:!0,features:[S],decls:20,vars:0,consts:[[1,"profile-wrapper","d-flex"],[1,"col-md-2","sidebar"],[1,"fw-bold"],[1,"list-unstyled"],[1,"text-danger","fw-semibold","mb-2"],[1,"text-muted","mb-4"],[1,"text-muted","mb-2",3,"click"],[1,"btn","btn-danger","col-9",3,"click"],[1,"col-md-9"]],template:function(t,r){t&1&&(n(0,"div",0)(1,"aside",1)(2,"h4",2),l(3,"Manage My Account"),i(),n(4,"ul",3)(5,"li",4),l(6,"My Profile"),i(),n(7,"li",5),l(8,"My Payment Options"),i()(),n(9,"h6",2),l(10,"My Orders"),i(),n(11,"ul",3)(12,"li",6),_("click",function(){return r.goToOrders()}),l(13,"My Returns"),i(),n(14,"li",5),l(15,"My Cancellations"),i()(),n(16,"button",7),_("click",function(){return r.logout()}),l(17,"Logout"),i()(),n(18,"section",8),u(19,"app-profile-form"),i()())},dependencies:[w,E,v,B],styles:[".profile-wrapper[_ngcontent-%COMP%]{gap:2rem;padding:2rem}.sidebar[_ngcontent-%COMP%]{width:250px;font-size:14px}.sidebar[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style:none;padding:0}.sidebar[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{padding:5px 0;cursor:pointer}.sidebar[_ngcontent-%COMP%]   .active[_ngcontent-%COMP%]{color:red;font-weight:700}"]})}}return e})();var oe=[{path:"",component:T}],Z=(()=>{class e{static{this.\u0275fac=function(t){return new(t||e)}}static{this.\u0275mod=C({type:e})}static{this.\u0275inj=F({imports:[v.forChild(oe),v]})}}return e})();var Ae=(()=>{class e{static{this.\u0275fac=function(t){return new(t||e)}}static{this.\u0275mod=C({type:e})}static{this.\u0275inj=F({imports:[w,Z,T]})}}return e})();export{Ae as ProfileModule};
